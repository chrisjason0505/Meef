# 🦠 Malware Collection & Processing Guide

## ⚠️ CRITICAL SAFETY WARNING

**NEVER do this on your main machine!**

### Required Setup:
1. ✅ **Isolated VM** (VirtualBox, VMware, or Hyper-V)
2. ✅ **No network access** (or isolated network)
3. ✅ **Snapshot before processing** (so you can restore)
4. ✅ **Never execute the malware** (only analyze)

---

## 📥 Step 1: Download Malware Samples

### Method A: Using MalwareBazaar (Recommended)

```bash
# 1. Run the downloader script
python3 download_samples.py

# 2. Choose option [1] for recent samples or [2] for specific types
# Examples of tags:
#   - ransomware
#   - trojan
#   - banker
#   - stealer
#   - loader
#   - rat (Remote Access Trojan)

# 3. Samples are downloaded to: samples/malicious/
```

**What you get:**
- Password-protected `.zip` files
- Default password: `infected`
- Named by SHA256 hash

---

### Method B: Manual Download from MalwareBazaar Website

1. Visit: https://bazaar.abuse.ch/browse/
2. Filter by file type (e.g., "exe", "dll")
3. Download samples (they come as `.zip`)
4. Save to `samples/malicious/`
5. Password for all zips: `infected`

**Example:**
```bash
cd samples/malicious
# Download a few samples from website
ls -lh
# Output:
# a3f2e1d4b7c9.zip
# f5e8d2a1c4b7.zip
# d9c7b3a2f1e5.zip
```

---

### Method C: Using the API Directly

```bash
# Download specific sample by SHA256
curl -X POST https://mb-api.abuse.ch/api/v1/ \
  -d "query=get_file" \
  -d "sha256_hash=YOUR_SHA256_HERE" \
  -o samples/malicious/sample.zip

# Password: infected
```

---

## 📦 Step 2: Process Samples (Automated Pipeline)

### Option 1: Complete Automated Pipeline

```bash
# Make script executable
chmod +x process_malware.sh

# Run the complete pipeline
./process_malware.sh
```

**This script will:**
1. ✅ Extract `.zip` files (password: infected)
2. ✅ Find `.exe`/`.dll` inside
3. ✅ Disassemble to `.asm`
4. ✅ Parse with MEEF
5. ✅ Generate IR JSON
6. ✅ Clean up temporary files

---

### Option 2: Manual Step-by-Step

```bash
# 1. Extract a sample
cd samples/malicious
unzip -P infected a3f2e1d4b7c9.zip
# Extracts: malware.exe

# 2. Disassemble
objdump -d -M intel malware.exe > malware.asm

# 3. Parse with MEEF
../../src/cd_frontend/meef_parser malware.asm ../../output/ir_results/malware_ir.json

# 4. Check result
cat ../../output/ir_results/malware_ir.json
```

---

### Option 3: Using MEEF Orchestrator

```bash
# After extracting and disassembling, just run:
python3 meef.py

# Path: samples/malicious
# Choice: A (process all)
```

---

## 📊 Step 3: Verify Your Collection

```bash
# Check downloaded archives
ls -lh samples/malicious/*.zip

# Check disassembled files
ls -lh samples/malicious/*.asm

# Check generated IR
ls -lh output/ir_results/*.json

# View catalog
cat data/catalog.csv | column -t -s,
```

---

## 🎯 Recommended Collection Strategy

### For ML Training, you need:

**1. Balanced Dataset:**
```
samples/
├── malicious/          # 500-1000 samples
│   ├── ransomware/     # 100-200 samples
│   ├── trojan/         # 100-200 samples
│   ├── banker/         # 100-200 samples
│   ├── stealer/        # 100-200 samples
│   └── loader/         # 100-200 samples
└── benign/             # 500-1000 samples
    ├── system/         # Windows system files
    ├── tools/          # Legitimate tools
    └── apps/           # Common applications
```

**2. Start Small, Scale Up:**
```bash
# Week 1: Download 10 samples per category
python3 download_samples.py
# Tag: ransomware, Limit: 10

# Week 2: Download 50 more
# Week 3: Download 100 more
# etc.
```

---

## 🛡️ Safety Checklist

Before starting, verify:

- [ ] Running in isolated VM
- [ ] VM has no network (or isolated network only)
- [ ] Created VM snapshot
- [ ] Antivirus disabled in VM (it will delete samples)
- [ ] Malware stays compressed until processing
- [ ] Never double-click .exe files
- [ ] Have backups of your analysis environment

---

## 🔍 Sample Sources Summary

| Source | Free | API | Easy | Bulk Download |
|--------|------|-----|------|---------------|
| **MalwareBazaar** | ✅ | ✅ | ✅ | ✅ |
| VirusTotal | ❌ | ✅ | ❌ | ❌ |
| theZoo (GitHub) | ✅ | ❌ | ✅ | ✅ |
| Hybrid Analysis | ✅ | ✅ | ⚠️ | ⚠️ |
| ANY.RUN | ⚠️ | ❌ | ✅ | ❌ |

**Legend:** ✅ Yes | ❌ No | ⚠️ Limited

---

## 📝 Example Collection Session

```bash
# Session 1: Collect ransomware samples
python3 download_samples.py
# Option: [2]
# Tag: ransomware
# Limit: 20

# Session 2: Process them
./process_malware.sh
# Processes all 20 automatically

# Session 3: Verify
ls output/ir_results/ | wc -l
# Should show 20 files

# Session 4: Check catalog
cat data/catalog.csv
# Should have 20 entries
```

---

## 🚨 Common Issues

### Issue: "Password incorrect"
**Solution:** Try these passwords:
- `infected` (most common)
- `malware`
- `virus`
- Check MalwareBazaar page for specific password

### Issue: "No executable found"
**Solution:** Some archives contain:
- Nested zips
- Scripts (.vbs, .js, .ps1)
- Documents (.doc, .pdf)
- Extract manually and check

### Issue: "Disassembly failed"
**Solution:**
- File might be packed/encrypted
- Try using other tools (IDA, Ghidra)
- Some samples can't be disassembled easily

### Issue: "VM infected!"
**Calm down:** 
1. Restore from snapshot
2. Don't panic
3. Never execute malware directly
4. If you didn't run .exe, you're likely safe

---

## 💡 Pro Tips

1. **Organize by family:**
```bash
mkdir -p samples/malicious/{ransomware,trojan,banker,stealer,loader}
# Download specific types to specific folders
```

2. **Keep metadata:**
```bash
# The download script saves metadata automatically
cat samples/malicious/malware_metadata.json
```

3. **Batch processing:**
```bash
# Process 10 samples at a time
./process_malware.sh
# Check results before processing more
```

4. **For benign samples:**
```bash
# Copy from Windows system
cp /mnt/c/Windows/System32/{notepad,calc,mspaint}.exe samples/benign/
# Then disassemble them
```

---

## 🎓 Learning Resources

- **MalwareBazaar Guide:** https://bazaar.abuse.ch/api/
- **Malware Analysis Basics:** https://www.malware-traffic-analysis.net/
- **Safe Lab Setup:** Search "malware analysis lab setup" on YouTube

---

## ✅ Quick Start Checklist

```bash
# 1. VM Setup
[ ] VM created and isolated
[ ] Snapshot taken
[ ] Network disabled

# 2. Download samples
[ ] python3 download_samples.py
[ ] Samples in samples/malicious/*.zip

# 3. Process samples
[ ] chmod +x process_malware.sh
[ ] ./process_malware.sh
[ ] IR files in output/ir_results/

# 4. Verify
[ ] Check catalog.csv
[ ] Review IR JSON files
[ ] Ready for ML training!
```

---

**Remember: Malware analysis is dangerous. Always work in isolated VMs!** 🛡️
